<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title>EMA Map</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.29.0/mapbox-gl.js'></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.29.0/mapbox-gl.css' rel='stylesheet' />
    <style>
        body { margin:0; padding:0; }
        #map { position:absolute; top:0; bottom:0; width:100%; }
    </style>
</head>
<body>
  <div id='map'></div>
    <div class="btn-group">
      <i class="dropdown-arrow dropdown-arrow-inverse"></i>
      <button class="btn btn-primary">EMA Program</button>
      <button class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
        <span class="caret"></span>
      </button>
      <ul class="dropdown-menu dropdown-inverse">
        <li><a href="#link">4CITIES</a></li>
        <li><a href="#link">ACES</a></li>
        <li><a href="#link">ADVANCES</a></li>
        <li><a href="#link">AMASE</a></li>
        <li><a href="#link">ARCHMAT</a></li>
        <li><a href="#link">ASC</a></li>
        <li><a href="#link">ASTROMUNDUS</a></li>
        <li><a href="#link">ATOMSIM</a></li>
        <li><a href="#link">BIFTEC</a></li>
        <li><a href="#link">CARTO</a></li>
        <li><a href="#link">ChIR</a></li>
        <li><a href="#link">CHOREOMUNDUS</a></li>
        <li><a href="#link">CLE</a></li>
        <li><a href="#link">CoDe</a></li>
        <li><a href="#link">CoMEM</a></li>
        <li><a href="#link">COSI</a></li>
        <li><a href="#link">CWCN</a></li>
        <li><a href="#link">DCLead</a></li>
        <li><a href="#link">DESEM</a></li>
        <li><a href="#link">Dyclam</a></li>
        <li><a href="#link">EACH</a></li>
        <li><a href="#link">EDAMUS</a></li>
        <li><a href="#link">EM HRPP</a></li>
        <li><a href="#link">EMARO +</a></li>
        <li><a href="#link">EMECC NURSING</a></li>
        <li><a href="#link">EMERALD</a></li>
        <li><a href="#link">EMGS</a></li>
      </ul>
    </div>

<script>
mapboxgl.accessToken = 'pk.eyJ1IjoiaXNrYW5kYXJibHVlIiwiYSI6ImNpdnNxdGo4bDA1d2UydHA1YzhybndobWMifQ.olkCyIyzu2YP2OWErDTSbA';
var map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/dark-v9',
    center: [15.2551, 54.5260],
    zoom: 3
});

function getRandomColor() {
    var letters = '0123456789ABCDEF';
    var color = '#';
    for (var i = 0; i < 6; i++ ) {
        color += letters[Math.floor(Math.random() * 16)];
    }
    return color;
}

var color = getRandomColor()

console.log(color);

map.on('style.load', function (e) {
    console.log(e.style.sprite);
    map.addSource('uni', {
        "type": 'geojson',
        "data": './master_points.geojson'
    });

    map.addLayer({
        "id": "uni",
        "type": "circle",
        "source": "uni",
        "paint": {
          "circle-color" : "#3bb2d0",
          "circle-radius" : 7,
          "circle-opacity" :0.5

        },

  });
});

$().ready(function(){
    $('a').click(function(){
        var value = $(this).text();
        console.log(value);

        map.setFilter('uni', ['==', 'code', value]);

/*
    // Add a layer for this symbol type if it hasn't been added already.
    if (!map.getLayer(layerID)) {
        map.addLayer({
            "id": layerID,
            "type": "circle",
            "source": "uni",
            "paint": {
                "circle-color": "#F0F564",
            },
            "filter": ["==", "code", symbol]
        });
      }
    */
    });
  });

  var popup = new mapboxgl.Popup({
      closeButton: true,
      closeOnClick: true
  });

  map.on('mousemove', function(e) {
      var features = map.queryRenderedFeatures(e.point, { layers: ['uni'] });
      // Change the cursor style as a UI indicator.
      map.getCanvas().style.cursor = (features.length) ? 'pointer' : '';

      console.log(features[0].properties)

     if (!features.length) {
          popup.remove();
          return;
      }

      // Populate the popup and set its coordinates
      // based on the feature found.
      popup.setLngLat([features[0].properties.lon, features[0].properties.lat])
          .setHTML(features[0].properties.title + '<div>' + features[0].properties.website + '</div>')
          .addTo(map);
  });


</script>

</body>
</html>
